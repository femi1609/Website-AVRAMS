<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulnerability Risk Assessment</title>
    <style>
        body {
        font-family: Arial, sans-serif;
        background-image: url("{{ url_for('static', filename='images/vulnerability1.jpg')}}");
        background-size: cover;
        background-position: center;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
    }


        .container {
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 80%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .intro {
            margin-bottom: 20px;
            text-align: center;
            font-size: 16px;
            color: #555;
        }
	
	label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input[type="text"], input[type="number"], input[type="date"], input[type="file"], select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .manual_input_set {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f9f9f9;
            position: relative;
        }

        .manual_input_set h3 {
            margin-top: 0;
        }

        .remove-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        .remove-button:hover {
            background-color: #c82333;
        }

        .button-container {
            text-align: center;
            margin-top: 20px;
        }

        input[type="submit"] {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        input[type="submit"]:hover {
            background-color: #0056b3;
        }
    </style>
    <script>
        let fieldSetCount = 0;

        function toggleInputs() {
            const inputMethod = document.getElementById("input_method").value;
            document.getElementById("manual_inputs").style.display = inputMethod === "manual" ? "block" : "none";
            document.getElementById("csv_upload").style.display = inputMethod === "csv" ? "block" : "none";
            updatePredictButtonVisibility();
        }

        function handleMoreData(currentFieldSetId) {
            const moreData = document.getElementById(`more_data_${currentFieldSetId}`).value.toLowerCase();
            if (moreData === "yes") {
                addNewFieldSet();
            } else {
                updatePredictButtonVisibility();
            }
        }

        function addNewFieldSet() {
            fieldSetCount++;
            const fieldSetContainer = document.getElementById("manual_input_sets");

            const newFieldSet = document.createElement("div");
            newFieldSet.className = "manual_input_set";
            newFieldSet.id = `data_set_${fieldSetCount}`;
            newFieldSet.innerHTML = `
                <h3>Vulnerability ${fieldSetCount + 1}</h3>
                <button class="remove-button" onclick="removeFieldSet(${fieldSetCount})">-</button>
                <label for="cve_id_${fieldSetCount}">CVE ID:</label>
                <input type="text" id="cve_id_${fieldSetCount}" name="cve_id_${fieldSetCount}" placeholder="e.g., CVE-2024-12345" required>
                <br><br>
                <label for="vendor_name_${fieldSetCount}">Vendor Name:</label>
                <input type="text" id="vendor_name_${fieldSetCount}" name="vendor_name_${fieldSetCount}" placeholder="e.g., Apache, Microsoft" required>
                <br><br>
                <label for="cwe_${fieldSetCount}">CWE:</label>
                <input type="text" id="cwe_${fieldSetCount}" name="cwe_${fieldSetCount}" placeholder="e.g., CWE-125 Out-of-bounds Read" required>
                <br><br>
                <label for="base_score_${fieldSetCount}">Base Score:</label>
                <input type="number" id="base_score_${fieldSetCount}" name="base_score_${fieldSetCount}" step="0.1" min="0" max="10" placeholder="0-10" required>
                <br><br>
                <label for="exploitability_score_${fieldSetCount}">Exploitability Score:</label>
                <input type="number" id="exploitability_score_${fieldSetCount}" name="exploitability_score_${fieldSetCount}" step="0.1" min="0" max="10" placeholder="0-10" required>
                <br><br>
                <label for="impact_score_${fieldSetCount}">Impact Score:</label>
                <input type="number" id="impact_score_${fieldSetCount}" name="impact_score_${fieldSetCount}" step="0.1" min="0" max="10" placeholder="0-10" required>
                <br><br>
                <label for="publish_date_${fieldSetCount}">Publish Date:</label>
                <input type="date" id="publish_date_${fieldSetCount}" name="publish_date_${fieldSetCount}" required>
                <br><br>
                <label for="update_date_${fieldSetCount}">Update Date:</label>
                <input type="date" id="update_date_${fieldSetCount}" name="update_date_${fieldSetCount}" required>
                <br><br>
                <label for="more_data_${fieldSetCount}">Add more vulneranability? (yes/no):</label>
                <input type="text" id="more_data_${fieldSetCount}" name="more_data_${fieldSetCount}" oninput="handleMoreData(${fieldSetCount})" required>
                <br><br>
            `;
            fieldSetContainer.appendChild(newFieldSet);
            updatePredictButtonVisibility();
        }

        function removeFieldSet(id) {
            const fieldSets = document.querySelectorAll(".manual_input_set");
            if (fieldSets.length > 1) {
                const fieldSet = document.getElementById(`data_set_${id}`);
                fieldSet.remove();
                fieldSetCount--;
                updateFieldSetLabels();
                updatePredictButtonVisibility();
            } else {
                alert("At least one data set must remain.");
            }
        }

        function updateFieldSetLabels() {
            const fieldSets = document.querySelectorAll(".manual_input_set");
            fieldSets.forEach((set, index) => {
                set.querySelector("h3").textContent = `Vulnerability ${index + 1}`;
                const inputs = set.querySelectorAll("input, label");
                inputs.forEach(input => {
                    const id = input.getAttribute("id");
                    if (id) {
                        const newId = id.replace(/\d+/, index);
                        input.setAttribute("id", newId);
                        if (input.tagName === "LABEL") {
                            input.setAttribute("for", newId);
                        }
                    }
                });
            });
        }

        function updatePredictButtonVisibility() {
            const inputMethod = document.getElementById("input_method").value;
            const predictButton = document.getElementById("predict_button");
            if (inputMethod === "manual") {
                const allFieldSets = document.querySelectorAll(".manual_input_set");
                const allFilled = Array.from(allFieldSets).every(set => {
                    const inputs = set.querySelectorAll("input");
                    return Array.from(inputs).every(input => input.value.trim() !== "");
                });
                predictButton.style.display = allFilled ? "block" : "none";
            } else if (inputMethod === "csv") {
                predictButton.style.display = document.getElementById("csv_file").files.length > 0 ? "block" : "none";
            } else {
                predictButton.style.display = "none";
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Vulnerability Risk Assessment</h1>
        <div class="intro">
            <p>Welcome to the Vulnerability Risk Assessment tool. This application helps assess and manage software vulnerabilities by predicting the likelihood of exploitation and prioritizing vulnerabilities based on various metrics.</p>
            <p>Input your data below to get started!</p>
        </div>
	<form action="/predict" method="post" enctype="multipart/form-data">
            <label for="input_method">Choose input method:</label>
            <select id="input_method" name="input_method" onchange="toggleInputs()" required>
                <option value="">Select Method</option>
                <option value="manual">Manual Input</option>
                <option value="csv">CSV Upload</option>
            </select>

            <div id="manual_inputs" style="display:none;">
                <div id="manual_input_sets">
                    <div class="manual_input_set" id="data_set_0">
                        <h3>Vulnerability 1</h3>
                        <label for="cve_id_0">CVE ID:</label>
                        <input type="text" id="cve_id_0" name="cve_id_0" placeholder="e.g., CVE-2024-12345" required>
                        <br><br>
                        <label for="vendor_name_0">Vendor Name:</label>
                        <input type="text" id="vendor_name_0" name="vendor_name_0" placeholder="e.g., Apache, Microsoft" required>
                        <br><br>
                        <label for="cwe_0">CWE:</label>
                        <input type="text" id="cwe_0" name="cwe_0" placeholder="e.g., CWE-125 Out-of-bounds Read" required>
                        <br><br>
                        <label for="base_score_0">Base Score:</label>
                        <input type="number" id="base_score_0" name="base_score_0" step="0.1" min="0" max="10" placeholder="0-10" required>
                        <br><br>
                        <label for="exploitability_score_0">Exploitability Score:</label>
                        <input type="number" id="exploitability_score_0" name="exploitability_score_0" step="0.1" min="0" max="10" placeholder="0-10" required>
                        <br><br>
                        <label for="impact_score_0">Impact Score:</label>
                        <input type="number" id="impact_score_0" name="impact_score_0" step="0.1" min="0" max="10" placeholder="0-10" required>
                        <br><br>
                        <label for="publish_date_0">Publish Date:</label>
                        <input type="date" id="publish_date_0" name="publish_date_0" required>
                        <br><br>
                        <label for="update_date_0">Update Date:</label>
                        <input type="date" id="update_date_0" name="update_date_0" required>
                        <br><br>
                        <label for="more_data_0">Add more vulnerability? (yes/no):</label>
                        <input type="text" id="more_data_0" name="more_data_0" oninput="handleMoreData(0)" required>
                        <br><br>
                    </div>
                </div>
            </div>

            <div id="csv_upload" style="display:none;">
                <label for="csv_file">Upload CSV File:</label>
                <input type="file" id="csv_file" name="csv_file" accept=".csv" onchange="updatePredictButtonVisibility()" required>
            </div>

            <div class="button-container">
                <input type="submit" id="predict_button" value="Predict" style="display:none;">
            </div>
        </form>
    </div>
</body>
</html>
